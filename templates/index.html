<!DOCTYPE html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="static/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Potta+One&family=Rubik+Scribble&family=Rubik+Spray+Paint&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,opsz,wght@0,6..96,400..900;1,6..96,400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://csshake.surge.sh/csshake.min.css">
    <link rel="stylesheet" type="text/css" href="https://csshake.surge.sh/csshake.min.css">


</head>
<body>
  <input type="checkbox" id="is-test" checked>
  <div id="content-div">
        <h1>NEEDLE DROPPER</h1>
        <div id="selectas">
          <div id="top-row">
            <div class="select-wrapper genre-wrapper">
              <select id="genre-select" class="select-box">
                  <option disabled selected value> ANY GENRE </option>
              </select>
            </div>
            <div class="select-wrapper">
                <select id="start-year-select" class="select-box">
                    <option disabled selected value> FROM </option>
                </select>
            </div>
            <div class="select-wrapper">
                <select id="end-year-select" class="select-box">
                    <option disabled selected value> TO </option>
                </select>
            </div>
            <div id="randomize-button" class="randomize-button select-wrapper">
              <i class="fa-solid fa-shuffle"></i>
            </div>
            <div id="reset-button" class="randomize-button select-wrapper" style="margin-right: 0;">
              <i class="fa-solid fa-rotate-left"></i>
            </div>
          </div>
            

            <div id="clip-div">
              <div id="cover-div">
                <img id="clip-cover" src="">
                <i id="play-button"><i class="fa-solid fa-play"></i></i>
              </div>
              <audio id="clip-audio" controls="" loop="true" src=""></audio>
              <div id="player"></div>

              <div id="clip-info-div">
                <p id="clip-info"></p>
                <div id="track-div">
    
                  <div id="clip-visualization"></div>
                  <p id="clip-times"></p>
                </div>
              </div>
            </div>

            <div id="go-buttons">
              <div id="pocket-button" class="go-button shrunken">
                <i class="fa-solid fa-download"></i>
                <p class="button-text">POCKET</p>
                <div class="dropdown">
                  <div id="clip-button" class="pocket-option">Clip</div>
                  <div id="track-button" class="pocket-option">Track</div>
                </div>
              </div>
              <div id="drop-button" class="go-button shrunken ">
                <i class="fa-solid fa-map-pin"></i>                
                <p class="button-text">RE-DROP</p>
              </div>
              <div id="dig-button" class="go-button expanded" style="transition: none;">
                <i class="fa-solid fa-compact-disc"></i>                
                <p class="button-text">DIG</p>
              </div>
            </div>
        </div>
    </div>

<script>
const genres = "A Cappella|Abstract|Abstract Beats|Abstract Hip Hop|Abstract Idm|Abstractro|Accordion|Acid House|Acid Jazz|Acid Techno|Acousmatic|Acoustic Blues|Acoustic Pop|Adult Standards|African Percussion|African Rock|Afrikaans|Afrobeat|Afrobeats|Aggrotech|Albanian Pop|Album Rock|Albuquerque Indie|Alternative Americana|Alternative Country|Alternative Dance|Alternative Emo|Alternative Hardcore|Alternative Hip Hop|Alternative Metal|Alternative Metalcore|Alternative New Age|Alternative Pop|Alternative Pop Rock|Alternative R&b|Alternative Rock|Alternative Roots Rock|Ambeat|Ambient|Ambient Dub Techno|Ambient Fusion|Ambient Idm|Ambient Psychill|Ambient Trance|Anarcho-punk|Andean|Anime|Anime Score|Anti-folk|Antiviral Pop|Appalachian Folk|Arab Folk|Arab Pop|Arabesk|Argentine Indie|Argentine Reggae|Argentine Rock|Armenian Folk|Art Rock|Athens Indie|Atmospheric Black Metal|Atmospheric Post Rock|Atmospheric Post-metal|Aussietronica|Austindie|Australian Alternative Rock|Australian Country|Australian Dance|Australian Hip Hop|Australian Indie|Australian Pop|Austrian Hip Hop|Austropop|Avant-garde|Avant-garde Jazz|Avantgarde Metal|Axe|Azonto|Bachata|Baile Funk|Balearic|Balkan Brass|Banda|Bangla|Barbershop|Barnemusikk|Barnmusik|Baroque|Baroque Ensemble|Basque Rock|Bass Music|Bass Trip|Bassline|Bay Area Hip Hop|Beach Music|Beatdown|Beats & Rhymes|Bebop|Belgian Indie|Belgian Rock|Belly Dance|Belorush|Bemani|Benga|Bhangra|Big Band|Big Beat|Big Room|Black Death|Black Metal|Black Sludge|Black Thrash|Blackgaze|Blaskapelle|Bluegrass|Blues|Blues-rock|Blues-rock Guitar|Bmore|Bolero|Boogaloo|Boogie-woogie|Bossa Nova|Bossa Nova Jazz|Boston Rock|Bounce|Bouncy House|Bow Pop|Boy Band|Brass Band|Brass Ensemble|Brazilian Composition|Brazilian Gospel|Brazilian Hip Hop|Brazilian Indie|Brazilian Pop Music|Brazilian Punk|Breakbeat|Breakcore|Breaks|Brega|Breton Folk|Brill Building Pop|British Alternative Rock|British Blues|British Brass Band|British Dance Band|British Folk|British Indie Rock|British Invasion|Britpop|Broadway|Broken Beat|Brooklyn Indie|Brostep|Brutal Death Metal|Brutal Deathcore|Bubble Trance|Bubblegum Dance|Bubblegum Pop|Bulgarian Rock|Byzantine|C-pop|C64|C86|Cabaret|Cajun|Calypso|Canadian Country|Canadian Hip Hop|Canadian Indie|Canadian Metal|Canadian Pop|Candy Pop|Cantautor|Cante Flamenco|Canterbury Scene|Cantopop|Canzone Napoletana|Capoeira|Carnatic|Catstep|Caucasian Folk|Ccm|Ceilidh|Cello|Celtic|Celtic Christmas|Celtic Punk|Celtic Rock|Central Asian Folk|Chalga|Chamber Pop|Chanson|Chanson Quebecois|Chaotic Black Metal|Chaotic Hardcore|Charred Death|Chicago Blues|Chicago House|Chicago Indie|Chicago Soul|Chicano Rap|Children's Christmas|Children's Music|Chilean Rock|Chill Groove|Chill Lounge|Chill-out|Chill-out Trance|Chillstep|Chillwave|Chinese Indie Rock|Chinese Opera|Chinese Traditional|Chip Hop|Chiptune|Choral|Choro|Christian Alternative Rock|Christian Christmas|Christian Dance|Christian Hardcore|Christian Hip Hop|Christian Metal|Christian Music|Christian Punk|Christian Rock|Christmas|Christmas Product|Cinematic Dubstep|Clarinet|Classic Afrobeat|Classic Belgian Pop|Classic Chinese Pop|Classic Colombian Pop|Classic Czech Pop|Classic Danish Pop|Classic Dutch Pop|Classic Eurovision|Classic Finnish Pop|Classic Finnish Rock|Classic French Pop|Classic Funk Rock|Classic Garage Rock|Classic Italian Pop|Classic Norwegian Pop|Classic Peruvian Pop|Classic Polish Pop|Classic Psychedelic Rock|Classic Rock|Classic Russian Pop|Classic Russian Rock|Classic Schlager|Classic Soundtrack|Classic Swedish Pop|Classic Turkish Pop|Classic Venezuelan Pop|Classical|Classical Christmas|Classical Flute|Classical Guitar|Classical Organ|Classical Performance|Classical Period|Classical Piano|College A Cappella|College Marching Band|Colombian Rock|Columbus Ohio Indie|Comedy|Comedy Rock|Comic|Commons|Complextro|Composition D|Concert Piano|Consort|Contemporary Classical|Contemporary Country|Contemporary Folk|Contemporary Jazz|Contemporary Post-bop|Cool Jazz|Corrosion|Corsican Folk|Country|Country Blues|Country Christmas|Country Dawn|Country Gospel|Country Road|Country Rock|Coupe Decale|Coverchill|Covertrance|Cowboy Western|Cowpunk|Crack Rock Steady|Croatian Pop|Crossover Prog|Crossover Thrash|Crunk|Crust Punk|Cryptic Black Metal|Cuban Rumba|Cubaton|Cumbia|Cumbia Funk|Cumbia Sonidera|Cumbia Villera|Cyber Metal|Czech Folk|Czech Rock|Dallas Indie|Dance Pop|Dance Rock|Dance-punk|Dancehall|Dangdut|Danish Hip Hop|Danish Indie|Danish Jazz|Danish Pop|Danish Pop Rock|Dansband|Danseband|Dansktop|Dark Ambient|Dark Black Metal|Dark Cabaret|Dark Electro-industrial|Dark Hardcore|Dark Jazz|Dark Minimal Techno|Dark Progressive House|Dark Psytrance|Dark Wave|Darkstep|Death Core|Death Metal|Deathgrind|Deep Acoustic Pop|Deep Adult Standards|Deep Alternative R&b|Deep Ambient|Deep Baroque|Deep Brazilian Pop|Deep Breakcore|Deep Canadian Indie|Deep Ccm|Deep Cello|Deep Chill|Deep Chill-out|Deep Christian Rock|Deep Classic Garage Rock|Deep Classical Piano|Deep Comedy|Deep Contemporary Country|Deep Dance Pop|Deep Darkpsy|Deep Deep House|Deep Deep Tech House|Deep Delta Blues|Deep Disco|Deep Disco House|Deep Discofox|Deep Downtempo Fusion|Deep Dub Techno|Deep East Coast Hip Hop|Deep Euro House|Deep Eurodance|Deep Filthstep|Deep Flow|Deep Folk Metal|Deep Free Jazz|Deep Freestyle|Deep Full On|Deep Funk|Deep Funk House|Deep G Funk|Deep German Indie|Deep German Punk|Deep Gothic Post-punk|Deep Happy Hardcore|Deep Hardcore|Deep Hardcore Punk|Deep Hardstyle|Deep House|Deep Indian Pop|Deep Indie Pop|Deep Indie Rock|Deep Indie Singer-songwriter|Deep Italo Disco|Deep Jazz Fusion|Deep Jazz Guitar|Deep Jazz Piano|Deep Latin Alternative|Deep Liquid|Deep Liquid Bass|Deep Melodic Death Metal|Deep Melodic Hard Rock|Deep Melodic House|Deep Melodic Metalcore|Deep Minimal Techno|Deep Motown|Deep Neo-synthpop|Deep Neofolk|Deep New Wave|Deep Nordic Folk|Deep Northern Soul|Deep Opera|Deep Orchestral|Deep Orgcore|Deep Pop Emo|Deep Pop Punk|Deep Power-pop Punk|Deep Progressive House|Deep Progressive Trance|Deep Psychobilly|Deep Psytrance|Deep Punk Rock|Deep Ragga|Deep Rai|Deep Regional Mexican|Deep Smooth Jazz|Deep Soft Rock|Deep Soul House|Deep Soundtrack|Deep Southern Soul|Deep Space Rock|Deep String Quartet|Deep Sunset Lounge|Deep Surf Music|Deep Symphonic Black Metal|Deep Talent Show|Deep Tech House|Deep Thrash Metal|Deep Trap|Deep Turkish Pop|Deep Uplifting Trance|Deep Vocal House|Deep Vocal Jazz|Delta Blues|Demoscene|Denver Indie|Depressive Black Metal|Desert Blues|Desi|Destroy Techno|Detroit Hip Hop|Detroit Techno|Didgeridoo|Digital Hardcore|Dirty South Rap|Dirty Texas Rap|Disco|Disco House|Discofox|Dixieland|Djent|Dominican Pop|Doo-wop|Doom Metal|Doomcore|Doujin|Downtempo|Downtempo Fusion|Downtempo Trip Hop|Drama|Dream Pop|Dreamo|Drill And Bass|Drone|Drone Folk|Drone Metal|Drone Psych|Drum And Bass|Drumfunk|Dub|Dub Techno|Dubstep|Dubstep Product|Dubsteppe|Duranguense|Dutch Hip Hop|Dutch House|Dutch Pop|Dutch Rock|E6fi|Early Music|Early Music Ensemble|East Coast Hip Hop|Easy Listening|Ebm|Ectofolk|Ecuadoria|Edm|Electric Blues|Electro|Electro Dub|Electro House|Electro Jazz|Electro Latino|Electro Swing|Electro Trash|Electro-industrial|Electroacoustic Improvisation|Electroclash|Electrofox|Electronic|Electronica|Electronicore|Electropowerpop|Electropunk|Emo|Emo Punk|Enka|Entehno|Environmental|Epicore|Estonian Pop|Ethereal Gothic|Ethereal Wave|Etherpop|Ethiopian Pop|Eurobeat|Eurodance|Europop|Euroska|Eurovision|Exotica|Experimental|Experimental Dubstep|Experimental Psych|Experimental Rock|Fado|Fake|Fallen Angel|Faroese Pop|Fast Melodic Punk|Fidget House|Filmi|Filter House|Filthstep|Fingerstyle|Finnish Hardcore|Finnish Hip Hop|Finnish Indie|Finnish Jazz|Finnish Metal|Finnish Pop|Flamenco|Flick Hop|Folk|Folk Christmas|Folk Metal|Folk Punk|Folk Rock|Folk-pop|Folk-prog|Folklore Argentino|Folkmusik|Footwork|Forro|Fourth World|Freak Folk|Freakbeat|Free Improvisation|Free Jazz|Freestyle|French Folk|French Folk Pop|French Hip Hop|French Indie Pop|French Movie Tunes|French Pop|French Punk|French Reggae|French Rock|Full On|Funeral Doom|Funk|Funk Carioca|Funk Metal|Funk Rock|Funky Breaks|Future Ambient|Future Garage|Futurepop|G Funk|Gabba|Galego|Gamecore|Gamelan|Gangster Rap|Garage Pop|Garage Punk|Garage Punk Blues|Garage Rock|Gauze Pop|Gbvfi|Geek Folk|Geek Rock|German Ccm|German Hip Hop|German Indie|German Metal|German Oi|German Pop|German Pop Rock|German Punk|German Show Tunes|German Techno|Ghettotech|Ghoststep|Girl Group|Glam Metal|Glam Rock|Glitch|Glitch Beats|Glitch Hop|Glitter Trance|Goa Trance|Goregrind|Gospel|Gospel Blues|Gospel Reggae|Gothic Alternative|Gothic Americana|Gothic Doom|Gothic Metal|Gothic Post-punk|Gothic Rock|Gothic Symphonic Metal|Grave Wave|Greek Hip Hop|Greek House|Greek Indie|Grim Death Metal|Grime|Grindcore|Grisly Death Metal|Groove Metal|Grunge|Grunge Pop|Grupera|Guidance|Gypsy Jazz|Hands Up|Happy Hardcore|Hard Alternative|Hard Bop|Hard Glam|Hard House|Hard Rock|Hard Stoner Rock|Hard Trance|Hardcore|Hardcore Breaks|Hardcore Hip Hop|Hardcore Punk|Hardcore Techno|Hardstyle|Harmonica Blues|Harp|Hatecore|Hauntology|Hawaiian|Healing|Heavy Alternative|Heavy Christmas|Heavy Gothic Rock|Hi Nrg|Highlife|Hindustani Classical|Hip Hop|Hip Hop Quebecois|Hip Hop Tuga|Hip House|Hip Pop|Hiplife|Hoerspiel|Hollywood|Honky Tonk|Horror Punk|Horrorcore|House|Hungarian Hip Hop|Hungarian Pop|Hungarian Rock|Hurban|Hyphy|Icelandic Pop|Idol|Illbient|Indian Classical|Indian Pop|Indian Rock|Indie Christmas|Indie Dream Pop|Indie Emo|Indie Emo Rock|Indie Folk|Indie Fuzzpop|Indie Pop|Indie Pop Rock|Indie Post-punk|Indie Psych-pop|Indie R&b|Indie Rock|Indie Shoegaze|Indie Singer-songwriter|Indietronica|Indonesian Indie|Indonesian Pop|Indorock|Industrial|Industrial Metal|Industrial Rock|Instrumental Post Rock|Intelligent Dance Music|Irish Folk|Irish Indie|Irish Rock|Iskelma|Islamic Recitation|Israeli Rock|Italian Disco|Italian Folk|Italian Hip Hop|Italian Indie Pop|Italian Jazz|Italian Pop|Italian Pop Rock|Italian Progressive Rock|Italian Punk|Italo Dance|J-alt|J-ambient|J-core|J-dance|J-idol|J-indie|J-metal|J-pop|J-poppunk|J-poprock|J-punk|J-rap|J-rock|J-theme|Jam Band|Jangle Pop|Jangle Rock|Japanese Jazztronica|Japanese Psychedelic|Japanese R&b|Japanese Standards|Japanese Traditional|Japanoise|Jazz|Jazz Bass|Jazz Blues|Jazz Brass|Jazz Christmas|Jazz Funk|Jazz Fusion|Jazz Metal|Jazz Orchestra|Jazz Trio|Jerk|Jig And Reel|Judaica|Jug Band|Juggalo|Jump Blues|Jump Up|Jumpstyle|Jungle|K-hop|K-indie|K-pop|K-rock|Kabarett|Karneval|Kc Indie|Kindermusik|Kirtan|Kiwi Rock|Kizomba|Klapa|Klezmer|Kompa|Kraut Rock|Kuduro|Kurdish Folk|Kwaito|La Indie|Laboratorio|Laiko|Latin|Latin Alternative|Latin Christian|Latin Christmas|Latin Electronica|Latin Hip Hop|Latin Jazz|Latin Metal|Latin Pop|Latvian Pop|Lds|Leeds Indie|Levenslied|Liedermacher|Light Music|Lilith|Liquid Funk|Lithumania|Liturgical|Lo Star|Lo-fi|Louisiana Blues|Louisville Indie|Lounge|Lounge House|Lovers Rock|Lowercase|Luk Thung|Madchester|Maghreb|Magyar|Makossa|Malagasy Folk|Malaysian Pop|Mallet|Mambo|Mande Pop|Mandopop|Manele|Marching Band|Mariachi|Martial Industrial|Mashup|Math Pop|Math Rock|Mathcore|Mbalax|Medieval|Medieval Rock|Meditation|Melancholia|Melbourne Bounce|Mellow Gold|Melodic Death Metal|Melodic Hard Rock|Melodic Hardcore|Melodic Metalcore|Melodic Power Metal|Melodic Progressive Metal|Memphis Blues|Memphis Hip Hop|Memphis Soul|Merengue|Merengue Urbano|Merseybeat|Metal|Metal Guitar|Metalcore|Metropopolis|Mexican Indie|Mexican Rock-and-roll|Mexican Son|Mexican Traditional|Miami Bass|Michigan Indie|Microhouse|Military Band|Minimal|Minimal Dub|Minimal Dubstep|Minimal Melodic Techno|Minimal Tech House|Minimal Techno|Minimal Wave|Mizrahi|Mod Revival|Modern Blues|Modern Classical|Modern Country Rock|Modern Downshift|Modern Free Jazz|Modern Performance|Modern Southern Rock|Modern Uplift|Monastic|Moombahton|Morna|Motivation|Motown|Movie Tunes|Mpb|Musica Para Ninos|Musiikkia Lapsille|Musique Concrete|Musique Pour Enfants|Muziek Voor Kinderen|Nasheed|Nashville Sound|Native American|Necrogrind|Neo Classical Metal|Neo Honky Tonk|Neo Mellow|Neo Metal|Neo Soul|Neo Soul-jazz|Neo-industrial Rock|Neo-pagan|Neo-progressive|Neo-psychedelic|Neo-rockabilly|Neo-singer-songwriter|Neo-synthpop|Neo-trad Metal|Neo-traditional Country|Neoclassical|Neofolk|Nepali|Nerdcore|Neue Deutsche Harte|Neue Deutsche Welle|Neurofunk|Neurostep|New Age|New Age Piano|New Americana|New Beat|New Jack Smooth|New Jack Swing|New Orleans Blues|New Orleans Jazz|New Rave|New Romantic|New Tribe|New Wave|New Wave Pop|New Weird America|Ninja|Nintendocore|Nl Folk|No Wave|Noise|Noise Pop|Noise Punk|Noise Rock|Nordic Folk|Nordic House|Norteno|Northern Irish Indie|Northern Soul|Norwegian Gospel|Norwegian Hip Hop|Norwegian Jazz|Norwegian Metal|Norwegian Pop|Norwegian Punk|Norwegian Rock|Nu Age|Nu Disco|Nu Electro|Nu Gaze|Nu Jazz|Nu Metal|Nu Skool Breaks|Nu-cumbia|Nueva Cancion|Nursery|Nwobhm|Nwothm|Nz Indie|Oi|Old School Hip Hop|Old-time|Opera|Operatic Pop|Opm|Oratory|Orchestral|Organic Ambient|Orgcore|Orquesta Tipica|Orquesta Tropical|Oshare Kei|Ostrock|Outer Hip Hop|Outlaw Country|Outsider|Outsider House|P Funk|Pagan Black Metal|Pagode|Pakistani Pop|Permanent Wave|Persian Pop|Persian Traditional|Perth Indie|Peruvian Rock|Piano Blues|Piano Rock|Piedmont Blues|Pipe Band|Poetry|Polish Hip Hop|Polish Indie|Polish Jazz|Polish Pop|Polish Punk|Polish Reggae|Polka|Polynesian Pop|Polyphony|Pop|Pop Christmas|Pop Emo|Pop House|Pop Punk|Pop Rap|Pop Rock|Popgaze|Porro|Portland Indie|Portuguese Pop|Portuguese Rock|Post Rock|Post-disco|Post-disco Soul|Post-grunge|Post-hardcore|Post-metal|Post-post-hardcore|Post-punk|Power Blues-rock|Power Electronics|Power Metal|Power Noise|Power Pop|Power Violence|Power-pop Punk|Praise|Progressive Alternative|Progressive Bluegrass|Progressive Electro House|Progressive House|Progressive Metal|Progressive Psytrance|Progressive Rock|Progressive Trance|Progressive Trance House|Progressive Uplifting Trance|Protopunk|Psych Gaze|Psychedelic Blues-rock|Psychedelic Rock|Psychedelic Trance|Psychill|Psychobilly|Pub Rock|Puerto Rican Rock|Punjabi|Punk|Punk Blues|Punk Christmas|Punk Ska|Qawwali|Quebecois|Quiet Storm|R&b|Ragga Jungle|Ragtime|Rai|Ranchera|Rap|Rap Metal|Rap Metalcore|Rap Rock|Raw Black Metal|Re:techno|Reading|Rebetiko|Reggae|Reggae Fusion|Reggae Rock|Reggaeton|Regional Mexican|Relaxative|Remix|Renaissance|Retro Electro|Retro Metal|Rhythm And Boogie|Riddim|Rio De La Plata|Riot Grrrl|Rock|Rock Catala|Rock En Espanol|Rock Gaucho|Rock Noise|Rock Steady|Rock-and-roll|Rockabilly|Romanian Pop|Romanian Rock|Romantic|Roots Reggae|Roots Rock|Rumba|Russian Alternative|Russian Hip Hop|Russian Pop|Russian Punk|Russian Rock|Rva Indie|Salsa|Salsa International|Samba|Saxophone|Schlager|Schranz|Scorecore|Scottish Rock|Scratch|Screamo|Screamo Punk|Screamocore|Seattle Indie|Sega|Serialism|Sertanejo|Sertanejo Tradicional|Sertanejo Universitario|Sevdah|Shanty|Sheffield Indie|Shibuya-kei|Shimmer Pop|Shimmer Psych|Shiver Pop|Shoegaze|Show Tunes|Singaporean Pop|Singer-songwriter|Sinhala|Ska|Ska Punk|Ska Revival|Skate Punk|Skiffle|Skinhead Oi|Skinhead Reggae|Skweee|Slam Death Metal|Slash Punk|Slc Indie|Sleaze Rock|Sleep|Slovak Hip Hop|Slovak Pop|Slovenian Rock|Slow Core|Sludge Metal|Smooth Jazz|Smooth Urban R&b|Soca|Soda Pop|Soft Rock|Solipsynthm|Soukous|Soul|Soul Blues|Soul Christmas|Soul Flow|Soul Jazz|Soundtrack|South African Jazz|Southern Gospel|Southern Hip Hop|Southern Rock|Southern Soul|Southern Soul Blues|Space Rock|Spanish Classical|Spanish Folk|Spanish Hip Hop|Spanish Indie Pop|Spanish Indie Rock|Spanish Invasion|Spanish New Wave|Spanish Pop|Spanish Pop Rock|Spanish Punk|Spanish Reggae|Speed Garage|Speed Metal|Speedcore|Spoken Word|Spytrack|Steampunk|Steelpan|Stl Indie|Stomp And Flutter|Stomp And Holler|Stomp And Whittle|Stomp Pop|Stoner Metal|Stoner Rock|Straight Edge|Street Punk|Stride|String Band|String Folk|String Quartet|Substep|Sunset Lounge|Suomi Rock|Surf Music|Swamp Blues|Swamp Pop|Swedish Alternative Rock|Swedish Hard Rock|Swedish Hip Hop|Swedish Indie Pop|Swedish Indie Rock|Swedish Jazz|Swedish Metal|Swedish Pop|Swedish Pop Punk|Swedish Prog|Swedish Punk|Swedish Reggae|Swedish Soft Pop|Swedish Synthpop|Swing|Swirl Psych|Swiss Folk|Swiss Hip Hop|Swiss Rock|Symphonic Black Metal|Symphonic Metal|Symphonic Rock|Synthpop|Taiwanese Pop|Talent Show|Tango|Tech House|Technical Brutal Death Metal|Technical Death Metal|Techno|Teen Pop|Tejano|Tekno|Terrorcore|Texas Blues|Texas Country|Thai Indie|Thai Pop|Thrash Core|Thrash Metal|Thrash-groove Metal|Throat Singing|Tibetan|Tico|Timba|Tin Pan Alley|Traditional Blues|Traditional British Folk|Traditional Country|Traditional Folk|Traditional Funk|Traditional Irish Folk|Traditional Reggae|Traditional Rock 'N Roll|Traditional Rockabilly|Traditional Scottish Folk|Traditional Ska|Traditional Soul|Traditional Swing|Trance|Trance Hop|Trap Music|Trapstep|Trash Rock|Triangle Indie|Tribal House|Tribute|Trip Hop|Tropical|Trova|Turbo Folk|Turkish Alternative|Turkish Classical|Turkish Folk|Turkish Hip Hop|Turkish Jazz|Turkish Pop|Turkish Rock|Turntablism|Twee Indie Pop|Twee Pop|Twin Cities Indie|Tzadik|Uk Dub|Uk Garage|Uk Hip Hop|Uk Post-punk|Ukrainian Rock|Ukulele|Unblack Metal|Underground Hip Hop|Underground Latin Hip Hop|Underground Pop Rap|Underground Power Pop|Underground Rap|Uplifting Trance|Urban Contemporary|Vallenato|Vancouver Indie|Vapor House|Vaporwave|Vegan Straight Edge|Vegas Indie|Velha Guarda|Venezuelan Rock|Video Game Music|Vienna Indie|Vietnamese Pop|Viking Metal|Vintage Chanson|Vintage Country Folk|Vintage Gospel|Vintage Jazz|Vintage Reggae|Vintage Rockabilly|Vintage Schlager|Vintage Swedish Pop|Vintage Swing|Vintage Swoon|Vintage Tango|Vintage Western|Violin|Viral Pop|Visual Kei|Vocal House|Vocal Jazz|Vocaloid|Volksmusik|Warm Drone|Welsh Rock|West African Jazz|West Coast Rap|Western Swing|Wind Ensemble|Witch House|Wonky|Workout|World|World Chill|World Christmas|World Fusion|Worship|Wrestling|Wrock|Ye Ye|Yoik|Yugoslav Rock|Zeuhl|Zillertal|Zim|Zolo|Zouglou|Zouk|Zydeco";
const genreList = genres.split('|');
let foundTrack = false;

if (document.getElementById('genre-select')) {
  const lines = genreList;
  const select = document.getElementById('genre-select');
  lines.forEach(line => {
    const option = document.createElement('option');
    option.value = line.trim();
    option.textContent = line.trim().toUpperCase();
    select.appendChild(option);
  });
}

const minYear = 1900;
const maxYear = new Date().getFullYear();

const startSelect = document.getElementById('start-year-select');
const endSelect   = document.getElementById('end-year-select');
const genreSelect = document.getElementById('genre-select');

function fillSelectRange(select, fromYear, toYear) {
  const oldValue = select.value;
  while (select.options.length > 1) {
    select.removeChild(select.options[select.options.length - 1]);
  }
  for (let y = toYear; y >= fromYear; y--) {
    const option = document.createElement('option');
    option.value = y;
    option.textContent = y;
    select.appendChild(option);
  }
  const oldValNum = parseInt(oldValue, 10);
  if (oldValNum && oldValNum >= fromYear && oldValNum <= toYear) {
    select.value = oldValue;
  }
}

fillSelectRange(startSelect, minYear, maxYear);
fillSelectRange(endSelect,   minYear, maxYear);

startSelect.value = minYear;
endSelect.value = maxYear;

startSelect.addEventListener('change', () => {
  const chosenStart = parseInt(startSelect.value, 10);
  fillSelectRange(endSelect, chosenStart, maxYear);
});

endSelect.addEventListener('change', () => {
  const chosenEnd = parseInt(endSelect.value, 10);
  fillSelectRange(startSelect, minYear, chosenEnd);
});

document.getElementById('randomize-button').addEventListener('click', () => {
  const randomGenre = genreList[Math.floor(Math.random() * genreList.length)];
  document.getElementById('genre-select').value = randomGenre;

  const randomStart = Math.floor(Math.random() * (maxYear - minYear)) + minYear; 
  const randomEnd   = Math.floor(Math.random() * (maxYear - (randomStart + 1))) + (randomStart + 1);

  document.getElementById('start-year-select').value = randomStart;
  document.getElementById('end-year-select').value = randomEnd;
});

document.getElementById('reset-button').addEventListener('click', () => {
  startSelect.value = minYear;
  endSelect.value = maxYear;
  document.getElementById('genre-select').value = '';
})

///////////////////////////////////////////////////////

function toggleClip() {
    const audio = document.getElementById('clip-audio');
    const playButton = document.getElementById('play-button');

    if (audio.paused) {
        audio.play();
        playButton.innerHTML = '<i class="fa-solid fa-pause"></i>';
    } else {
        audio.pause();
        playButton.innerHTML = '<i class="fa-solid fa-play"></i>';
    }
}

function visualizeClip(clipLength, startTime, duration) {

    const trackDiv = document.getElementById('track-div');
    const clipVisualization = document.getElementById('clip-visualization');
    const clipTimes = document.getElementById('clip-times');

    const startPercent = (startTime / duration) * 100;
    const durationPercent = (clipLength / duration) * 100;

    clipVisualization.style.left = `${startPercent}%`;
    clipVisualization.style.width = `${durationPercent}%`;

    const formattedStart = `${Math.floor(startTime / 60)}:${String(startTime % 60).padStart(2, '0')}`;
    const formattedEnd = `${Math.floor((startTime + 5)/ 60)}:${String((startTime + 5) % 60).padStart(2, '0')}`;
    clipTimes.textContent = `${formattedStart} - ${formattedEnd}`;
}

function pocket() {
    const audioElement = document.getElementById('clip-audio');

    if (!audioElement || !audioElement.src) {
        console.error('No audio source found to download.');
        return;
    }

    const audioSrc = audioElement.src;
    const trackTitle = document.getElementById('track-title').textContent;
    const trackArtist = document.getElementById('track-artist').textContent;
    const trackGenre = document.getElementById('track-genre').textContent;
    const clipTimes = document.getElementById('clip-times').textContent;

    const anchor = document.createElement('a');
    anchor.href = audioSrc;
    anchor.download = `${trackArtist} - ${trackTitle + ' (' + clipTimes.replace(/:/g, "'")}) (${trackGenre}).mp3`; 
    document.body.appendChild(anchor);

    anchor.click();
    document.body.removeChild(anchor);
};

function drop(id, duration) {
    const audioElement = document.getElementById('clip-audio');
    audioElement.pause();

    let playElement = document.getElementById('play-button');
    playElement.innerHTML = '<i class="fa-solid fa-spinner"></i>';
    playElement.classList.add('rotating');

    const coverDiv = document.getElementById('cover-div');
    coverDiv.removeEventListener('click', toggleClip);

    const dropButton = document.getElementById('drop-button');
    originalHtml = dropButton.innerHTML;
    dropButton.innerHTML = 'DROPPING...';

    const digButton = document.getElementById('dig-button');
    digButton.removeEventListener('click',dig);

    const clipTimes = document.getElementById('clip-times');
    clipTimes.innerHTML = 'Dropping the needle...';

    const clipVisualization = document.getElementById('clip-visualization');
    clipVisualization.style.width = 0;
    clipVisualization.classList.add('move-left-right');

    const pocketButton = document.getElementById('pocket-button');
    const clipButton = document.getElementById('clip-button');
    pocketButton.classList.remove('expanded');
    pocketButton.classList.add('shrunken');

    const goButtons = document.getElementById('go-buttons');
    goButtons.classList.add('collapse-go');

    const isTest = document.getElementById('is-test').checked;

    fetch('/drop', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify({id, duration, isTest}),
      })
      .then(response => {
          digButton.addEventListener('click',dig);
          goButtons.classList.remove('collapse-go');
          if (!response.ok) throw new Error('Fetch failed');
          dropButton.innerHTML = 'TRY AGAIN';
          return response.json();
      })
      .then(data => {
        fetch(data.path)
          .then(response => response.blob())
          .then(blob => {
            const url = URL.createObjectURL(blob);
            setupAudio(url);
            audioElement.play();

            fetch('/cleanup', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ path: data.path, isTest: isTest })
            }).catch(err => console.error('Cleanup failed:', err));

            clipVisualization.classList.remove('move-left-right');
            visualizeClip(5, data.start_time, duration);

            pocketButton.addEventListener('click', pocket);
            pocketButton.classList.remove('shrunken');
            pocketButton.classList.add('expanded');

            dropButton.classList.remove('shrunken');
            dropButton.classList.add('expanded');

            playElement.innerHTML = '<i class="fa-solid fa-pause"></i>';
            playElement.classList.remove('rotating');
            dropButton.innerHTML = originalHtml;
          });
      })
}

function dig() {
    const audioElement = document.getElementById('clip-audio');
    const pocketButton = document.getElementById('pocket-button');
    const clipButton = document.getElementById('clip-button');
    const reDropButton = document.getElementById('drop-button');
    const digButton = document.getElementById('dig-button');
    const clipDiv = document.getElementById('clip-div');
    const originalHtml = digButton.innerHTML;

    pocketButton.removeEventListener('click', pocket);
    pocketButton.classList.add('shrunken');
    pocketButton.classList.remove('expanded');

    reDropButton.classList.add('shrunken');
    reDropButton.classList.remove('expanded');

    if (!audioElement.paused) {
        audioElement.pause();
    }

    digButton.innerHTML = 'DIGGING...';
    digButton.classList.add('shake-slow', 'shake-constant');
    clipDiv.style.height = "0";
    clipDiv.style.marginTop = "0";

    const isTest = document.getElementById('is-test').checked;
    const genre = document.getElementById('genre-select').value;
    const startYear = document.getElementById('start-year-select').value;
    const endYear = document.getElementById('end-year-select').value;

    fetch('/dig', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ genre, startYear, endYear, isTest }),
    })
        .then(response => {
            if (!response.ok) throw new Error('Fetch failed');
            return response.json();
        })
        .then(data => {
            digButton.classList.remove('shake-slow', 'shake-constant');

            if (data.status === "error") {
                handleDigError(data.message, digButton, originalHtml, clipDiv);
            } else if (data.status === "success") {
                handleDigSuccess(data, digButton, originalHtml, clipDiv);
            }
        })
        .catch(error => {
            console.error('Error in digAndDrop:', error);
        });
}

function handleDigError(message, digButton, originalHtml, clipDiv) {
    digButton.innerHTML = message;
    digButton.classList.add('shake-little', 'shake-constant');

    setTimeout(() => {
        digButton.classList.remove('shake-little', 'shake-constant');
        digButton.innerHTML = originalHtml;
    }, 1000);

    if (typeof foundTrack !== "undefined" && foundTrack === true) {
        clipDiv.style.height = "200px";
        clipDiv.style.marginTop = "9px";
    }
}

function handleDigSuccess(data, digButton, originalHtml, clipDiv) {
    foundTrack = true;

    const dropButton = document.getElementById('drop-button');
    const audioElement = document.getElementById('clip-audio');
    const coverElement = document.getElementById('clip-cover');
    const clipInfo = document.getElementById('clip-info');

    digButton.innerHTML = originalHtml;
    coverElement.src = data.cover;

    clipInfo.innerHTML = `
        <span class='track-title' id='track-title'><a class="song-link" href=${data.url} target="_">${data.title}</a></span><br>
        by <b><span id='track-artist'>${data.artist}</span></b><br>
        from <b>${data.album_name} (${(data.release_date).substring(0, 4)})</b><br>
        <br>
        Genre: <span id='track-genre'>${data.genre}</span><br>
        Popularity: ${data.popularity}/100<br>`;

    coverElement.onload = () => {
        clipDiv.style.height = "200px";
        clipDiv.style.marginTop = "9px";
    };

    setupDropButton(data.id, data.duration);
    drop(data.id, data.duration);
}

function setupAudio(path) {
    const audioElement = document.getElementById('clip-audio');

    if (!path) {
        console.error('Audio path is empty.');
        return;
    }

    audioElement.src = path;
    audioElement.load();

    const coverDiv = document.getElementById('cover-div');
    coverDiv.addEventListener('click', toggleClip);
}

function updateButtonStates() {
    const buttons = document.querySelectorAll('.go-button');
    buttons.forEach(button => {
        button.classList.remove('shrunken');
        button.classList.add('expanded');
    });
}

function setupDropButton(id, duration) {
    const reDropButton = document.getElementById('drop-button');
    const newButton = reDropButton.cloneNode(true);
    reDropButton.parentNode.replaceChild(newButton, reDropButton);
    newButton.addEventListener('click', () => drop(id, duration));
}

document.getElementById('dig-button').addEventListener('click', dig);


</script>
</body> 